### JPA가 무엇이고 무슨 문제를 해결하기 위해 나왔을까?
1. 매우 귀찮은 반복적인 SQL 작업
2. 객체 지향과 관계형 DB의 패러다임의 불일치
    1. 상속
        
        객체지향에는 상속이 있지만 DB에는 상속이 없다. 따라서 상속이 되어 있는 객체를 DB에 집어 넣으려면 부모 테이블과 자식 테이블 둘 다에 Insert해야 하고 찾을 때는 Join해서 찾아온 후 각각 다시 집어 넣어주어야 하는 등 매우 불편하다.
        
        그래서 DB에 저장할 객체는 상속 관계를 안 쓰게 된다.
        
        그러나 자바에서 list에 저장한다고 생각해보면 이는 매우 간단해진다. 
        
        추가 - list.add(album);
        
        조회 - Album album = list.get(albumId);
        
    2. 연관관계
        
        연관된 애를 찾아갈 때 객체는 참조를 사용하고 테이블은 외래키를 사용한다. 이 때 객체는 한 방향으로만 갈 수 있지만 테이블은 양방향으로 갈 수 있다. 보통을 객체를 테이블의 맞춰서 모델링하게 되기 때문에 객체 지향적인 참조를 갖는 방식보다 외래키인 XXX_id를 변수로 갖는 방식이 된다.
        
        만약 참조를 갖도록 한다면 추가적인 매핑작업이 매우 많아지고 ROI가 안나온다. 결국 객체지향적인 방식을 포기하게 된다.
        
    3. 객체 그래프 탐색
        
        객체는 자신이 참조하고 있는 객체로 넘어갈 수 있고 또 그 객체가 참조하고 있는 객체로 넘어 갈 수 있다. getTeam().getOrder() 이런 식으로. 그런데 SQLMapper를 사용할 때는 처음 실행된 SQL에 따라 탐색범위가 결정된다. 그 때 연관된 모든 객체를 다 Join으로 가져왔다면 모든 객체 그래프를 탐색 가능하지만 이것은 너무 비효율적이다. 
        
        따라서 엔티티에 대한 신뢰 문제가 생기게 된다. 어떠한 객체가 있을 때 연관된 객체로 넘어갈 수 있을지 없을지 SQL을 까봐야만 알 수 있다. 이를 극복하기 위해 findMemberWithAddressWithCart 등등 경우의 수마다 메소드를 만들기도 한다.

### 즉시 로딩과 지연 로딩이란 무엇이고 언제 무엇을 쓰는 것이 좋을까?

어떤 객체를 DB에서 Select 할 때 연관된 객체를 join 또는 또 한번의 select를 통해 한꺼번에 가져오면 즉시 로딩이라고 한다. 반면에 일단은 실제로 Select한 객체만 가져오고 나머지 연관된 객체를 프록시의 형태로 넣어주었다가 실제로 이 객체가 쓰이는 순간에 실제로 Select 쿼리를 날려서 값을 세팅 해주는 것을 지연 로딩이라고 한다.

이론적으로는 자주 같이 쓰이는 것은 즉시 로딩, 가끔씩만 같이 쓰이는 것은 지연 로딩으로 하는 것이 좋다. 왜냐하면 지연 로딩은 쿼리가 두 번 이상 나가는 것이기 때문에 즉시 로딩보다 성능이 좋지 않다. 반면에 사용하지 않는데 굳이 Join해서 매번 가져오는 것도 비효율적이기 때문에 이 때는 지연 로딩이 나은 것이다.

하지만 실무에서는 모두 지연 로딩을 사용해야 한다. 왜냐하면 즉시 로딩은 연관된 객체에 연관된 객체를 꼬리에 꼬를 물고 모두 한꺼번에 가져오기 때문에 예상하지 못한 쿼리가 나갈 수 있다.

또한 JPQL을 사용할 때 즉시 로딩을 사용하면 N + 1 문제를 일으킬 수 있다.

따라서 JPA를 사용할 때는 모두 지연 로딩으로 깔고 즉시 로딩이 필요한 것은 fetch join이나 엔티티 그래프 기능을 사용한다.

---

김영한, 자바 ORM 표준 JPA 프로그래밍 - 기본편, 즉시 로딩과 지연 로딩
